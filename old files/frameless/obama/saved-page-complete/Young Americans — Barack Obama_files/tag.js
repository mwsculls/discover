window.BrightTag=function(c){function o(a,c){return Object.prototype.toString.call(a)==="[object "+c+"]"}function v(a){function j(a){var e,f,a=a.split(/; ?/);b={};for(var h=0,g=a.length;h<g;h++){f=a[h];e=f.indexOf("=");var d=b,c=f.slice(0,e);e=f.slice(e+1);e=unescape(e);d[c]=e}}function g(b,e,f){if(b){f=f||{};b=[b+"="+c.Escaper.cookie(e||"")];if((e=f.expires)||0===e)m.isNumber(e)&&(e=(new Date(e)).toGMTString()),b.push("expires="+e);(e=f.path)&&b.push("path="+e);(e=f.domain)&&b.push("domain="+e);
!0===f.secure&&b.push("Secure");!0===f.httponly&&b.push("HttpOnly");f=b.join(";");if(f.length<h)a.cookie=f;else throw{name:"CookieTooLongError",message:"Cookie reached 4096 byte limit"};j(a.cookie)}}function d(a,e){g(a,"",q(e||{},{expires:1}))}var b={},h=4096;j(a.cookie||"");return{get:function(a){return b[a]},set:g,remove:d,findEach:function(a,e){for(key in b)b.hasOwnProperty(key)&&key.match(a)&&e(key,b[key])},clear:function(){for(key in b)b.hasOwnProperty(key)&&d(key)}}}function B(a,c){function g(e,
f){a.setItem(e,f)}function d(a,f,b){(0===b||b>+new Date)&&c.setItem(a,JSON.stringify({value:f,expires:b}))}function b(e){return a.getItem(e)}function h(a){(a=c.getItem(a))&&(a=JSON.parse(a));return a&&(0===a.expires||a.expires>+new Date)?a.value:void 0}function i(a,f,b,h,i){for(var c,g,d=0,j=h.length;d<j;d++)c=h.key(d),!b[c]&&c.match(a)&&(b[c]=!0,void 0!=(g=i(c))&&f(c,g))}return{set:function(a,f,b){a&&(b=b||{},(void 0!=b.expires?d:g)(a,f,b.expires))},get:function(a){return b(a)||h(a)},findEach:function(e,
f){var g={};i(e,f,g,a,b);i(e,f,g,c,h)},remove:function(e){a.removeItem(e);c.removeItem(e)}}}function C(a){var a=v(a),c=a.set;a.set=function(a,d,b){b=q(b||{},{path:"/"});0===b.expires&&(b.expires=+new Date("1/1/2038"));c(a,d,b)};return a}if(c)return bt_log("tried to load tag.js again"),c;var c={pushIfDefined:function(a,c,g){a&&(a.constructor==Array&&null!=c)&&a.push(g||c)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Escaper:{cookie:function(a){return!m.isString(a)?a:a.replace(/%/g,
"%25").replace(/#/g,"%23").replace(/&/g,"%26").replace(/'/g,"%27").replace(/;/g,"%3B").replace(/</g,"%3C").replace(/>/g,"%3E")},javascript:function(a){return!m.isString(a)?a:a.replace(/\\/g,"\\\\").replace(/'/g,"\\x27").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}},Random:{integer:function(a){return Math.floor(Math.random()*(a||1E8))}},defaultConfig:function(){var a=C(document);window.localStorage&&window.sessionStorage&&(a=B(sessionStorage,localStorage));return{loadOnly:!1,window:window,
document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},store:a,errorManager:new c.ErrorManager(a)}}},x=c.eval=function(a,c,g){try{return g&&(a+=z(g)),eval.call(void 0,a)}catch(d){c&&c(d)}},z=function(a){return"\n//at-sourceURL=/BrightTag/"+a.replace(/\s+/g,"_")+".js"},q=c.extend=function(a,c){for(var g in c)c.hasOwnProperty(g)&&(a[g]=c[g]);return a},m=c.Types={isString:function(a){return o(a,"String")},isArray:function(a){return o(a,
"Array")},isNumber:function(a){return o(a,"Number")},isFunction:function(a){return o(a,"Function")},isObject:function(a){return null===a||void 0===a?!1:o(a,"Object")}},l=c.each=function(a,c){if(a)if(m.isArray(a)||a.length)for(var g=0,d=a.length;g<d;g++)c(a[g],g);else if(m.isObject(a))for(g in a)a.hasOwnProperty(g)&&c(g,a[g])};c.Blab={};c.Blab.Engine=function(a){function c(){p=!0;n=s.length;f("engine:off")}function g(){p=!1;D=0;(s[n++]||c)()}function d(){f("block:finish");g()}function b(e,b){return function(){var c=
!1,h=a.createElement("script");h.onload=h.onreadystatechange=function(){var a;if(!(a=c)){a:{switch(h.readyState){case void 0:case "loaded":case "complete":a=!0;break a}a=!1}a=!a}a||(c=!0,d())};h.onerror=function(){f("block:error",{type:"script",exception:"Problem loading "+e});c||d()};h.src=e;h.text=b;f("block:start",e);var i=a.getElementsByTagName("script")[0];i.parentNode.insertBefore(h,i)}}function h(e){return function(){try{if(f("block:start",e),e.constructor==String)if(a.defaultView){var b=z("tags/"+
(w.tagId||"adhoc")+"-inline-b"+(n-1));a.defaultView.eval.call(void 0,e+b)}else a.parentWindow?a.parentWindow.execScript(e):f("block:error",{type:"wait",exception:"Could not evaluate wait block ["+e+"]"});else e()}catch(c){f("block:error",{type:"wait",exception:c})}finally{d()}}}function i(a){s.push(a);p&&g();return k}function e(a){s.splice(n+D++,0,a);return k}function f(a){var e=Array.prototype.slice.call(arguments,1);l(t,function(f){var b=[k].concat(e);(f[a]||r).apply(null,b)})}var k=this,r=function(){},
t=[],p=!1,w={},s=[],n=0,D=0;k.run=function(){f("engine:on");g()};k.options=function(a){q(w,a);return k};k.option=function(a){return w[a]};k.script=function(a){return i(b(a))};k.wait=function(a){return i(h(a))};k.preemptScript=function(a,f){return e(b(a,f))};k.preemptWait=function(a){return e(h(a))};k.listen=function(a){t.push(a);(a["engine:listen"]||r).apply(null,[k]);return k}};c.Blab.Group=function(){function a(a){b.push(a)}function c(a){a.run()}function g(){var a=b[h++];a?a.listen(i).run():d.doNotQueue()}
var d=this,b=[],h=0,i={"engine:off":function(){g()}};d.doNotQueue=function(){a=c};d.push=function(e){a(e);return e};d.run=function(){g()};d.applyListener=function(a){for(var f=h,c=b.length;f<c;f++)b[f].listen(a)}};c.Blab.Manager=function(a){function j(c){var i=new g.Engine(a);l(b,function(a){i.listen(a)});return(d[c]||(d[c]=new g.Group)).push(i)}var g=c.Blab,d={undefined:new g.Group},b=[];d[void 0].doNotQueue();this.addGlobalListener=function(a){b.push(a);l(d,function(b){d[b].applyListener(a)})};
this.group=function(a){return j(a)};this.listen=function(){return j().listen.apply(null,arguments)};this.script=function(){return j().script.apply(null,arguments)};this.wait=function(){return j().wait.apply(null,arguments)};this.run=function(a){(d[a]||(d[a]=new g.Group)).run()};this.setOptions=function(){return j()}};var u,E=[],G=function(a){u.push(a)};c.Blab.SwapwriteListener=function(a){function c(a){a.src?d.preemptScript(a.src,a.innerHTML):a.innerHTML&&d.preemptWait(a.innerHTML)}function g(b){try{a.body.appendChild(b.cloneNode(!0))}catch(c){bt_log("error appending content to body: "+
c)}}var d,b=a.createElement("div");this["block:start"]=function(){var b=a;E.push([u,b.write,b.writeln]);u=[];b.write=b.writeln=G};this["block:finish"]=function(){try{if(0!=u.length){b.innerHTML="<br/>"+u.join("");for(var d=b.childNodes||[],i=1,e=d.length;i<e;i++)("SCRIPT"==d[i].tagName?c:g)(d[i])}}finally{d=a,i=E.pop(),u=i[0],d.write=i[1],d.writeln=i[2]}};this["engine:listen"]=function(a){d=a}};c.Blab.GlobalSwapwriteListener=function(a){var j=c.Blab;this["engine:listen"]=function(c){c.listen(new j.SwapwriteListener(a))}};
c.EventsManager=function(){function a(){}function j(a,b,f){h(a,b,function(){(!f||f())&&c.EventListenerOverride(a,b)})}function g(a){var b=a.readyState;if("loading"==b)return!1;if("complete"==b)return!0;if(a.addEventListener)return"interactive"==b;a:{a=a.documentElement.doScroll||function(){throw"No doScroll";};try{a("left")}catch(f){a=!1;break a}a=!0}return a}function d(a,b,f){var c=this;setTimeout(function(){a()?b.call(c):d(a,b,f)},f)}var b=this,h=b.listen=function(a,b,f){a.addEventListener?a.addEventListener(b,
f,!1):a.attachEvent&&a.attachEvent("on"+b,f)};b.domReady=function(a,b){g(a)?b.call(this):a.addEventListener?h(a,"DOMContentLoaded",b):d(function(){return g(a)},b,1)};b.enablePageReadyOverrides=function(d,e){b.enablePageReadyOverrides=a;"complete"==e.readyState?c.EventListenerOverride(d,"load"):j(d,"load");if(e.addEventListener){var f=e.readyState;"complete"==f||"interactive"==f?c.EventListenerOverride(e,"DOMContentLoaded"):j(e,"DOMContentLoaded")}}};c.EventListenerOverride=function(a,c){function g(a){var b=
this;setTimeout(function(){try{a.call(b)}catch(e){bt_log("error overriding "+c+" event: "+e)}},0)}var d=a.addEventListener?"addEventListener":"attachEvent",b=a[d];a[d]=function(h,i,e){if("function"==typeof i)if(h==c||h=="on"+c)g(i);else try{"addEventListener"==d?b.call(a,h,i,e):b(h,i)}catch(f){bt_log("error proxying "+h+" event: "+f)}}};c.Events=new c.EventsManager;c.EventBindingManager=function(a,j){function g(a,b){l(b,function(b,c){a[a.type+"."+b]=c});j.push(a)}function d(a){function c(a){var b=
this,f=[];b.appendData=function(a){f.push(function(b){b.appendData(a)});return b};b.appendJs=function(a){f.push(function(b){b.appendJs(a)});return b};b.postProcess=function(a){l(f,function(b){b(a)})};b.tagId=a;b.execute=e.execute;b.fire=e.fire;b.evaluate=e.evaluate}var e=this,d=[],h=[],j="true";e.execute=function(b,c){var h=q({eventName:a},c||{});if(m.isFunction(b))d.push(q(b,h));else if(m.isString(b))try{var k=z("events/"+a+"-tag-"+(h.tagId||"adhoc")),j=i.functionWithAccess(["eventObject","eventData"],
b+k);d.push(q(j,h))}catch(p){g({type:"evparse",message:p.toString(),tagId:h.tagId||-1},{eventName:a})}else bt_log("when.execute: unknown action: "+b);return e};e.evaluate=function(a){j=a;return e};e.fire=function(a){a=new c(a);h.push(a);return a};e.handler=function(a,c){var f=j;x(j,function(a){bt_log("Invalid post-event conditional fire expression: "+f+", exception = "+a)})&&(b.executeActions(d,a,c),b.fireTags(h))}}var b={},h={},i=c.jQueryLoader(a,"BrightTag.jQuery");b.Binder=function(a,b){var e=
this,d=[],j={},w=(b||{}).pageId;e.data=function(a,b){d.push({name:a,dbe:b});return e};e.bindData=function(b,e,h){l(d,function(d){var k=d.name;try{var A=j[d.dbe];if(!A){var F=d.dbe,r,t=d.dbe,m=z("event-dbes/"+k+"-page-"+(w||"adhoc")+"-event-"+a);r=i.functionWithAccess(["eventObject","eventData"],"return "+t+";"+m);A=j[F]=r}c.instance.data(k,A.call(b,e,h))}catch(l){g({type:"evdbe",message:l.toString(),pageId:w||-1},{name:k,eventName:a})}})};e.handler=function(b){var c=h[a];if(c){var d=Array.prototype.slice.call(arguments,
1);e.bindData(b.target,b,d);c.handler(b,d)}}};var e=/^direct\//i;b.bind=function(a,c,d,g){var h=new b.Binder(a,g);i.ensureJQuery(function(){var a=i.getJQuery()(c);a.live&&c.constructor===String&&!e.test(d)?a.live(d,h.handler):a.bind(d.split(e).pop(),h.handler)});return h};b.when=function(a){return h[a]||(h[a]=new d(a))};b.executeActions=function(a,b,c){l(a,function(a){try{a.call(b.target,b,c)}catch(e){g({type:"evwait",message:e.toString(),tagId:a.tagId||-1},{eventName:a.eventName})}})};b.fireTags=
function(a){if(0<a.length){var b=c.instance.serverURL();l(a,function(a){b.cf(a.tagId);a.postProcess(b)});c.Blab.script(b.asString())}};return b};c.HTTP={};c.HTTP.Cookie=v;c.HTTP.DOMStorage=B;c.HTTP.CookieStorage=C;c.HTTP.QueryString=function(a){function c(a){if(a&&"string"==typeof a){var d=a.split("&"),a={};l(d,function(c){var e=c.split("="),c=decodeURIComponent(e[0]),e=e[1]&&decodeURIComponent(e[1].replace(/\+/g," "));a[c]=e})}return a}var g=this,d={};q(d,c(a));g.param=function(a){return d[a]||""};
g.params=function(){return d};g.appendParam=function(a,c){a&&(void 0!=c&&""!==c)&&(d[a]=c);return this};g.appendParams=function(a){l(a,g.appendParam);return this};g.alwaysAppendParam=function(a,c){a&&(d[a]=void 0!=c?c:"");return this};g.alwaysAppendParams=function(a){l(a,g.alwaysAppendParam);return this};g.appendPartialQueryString=function(a){a&&g.alwaysAppendParams(c(a));return this};g.deleteParam=function(a){delete d[a]};g.toString=function(){var a=[],c;for(c in d){var g=encodeURIComponent(c),e=
encodeURIComponent(d[c]);a.push(g+"="+e)}return a.join("&")}};c.HTTP.URL=function(a){var j=this,g,d,b,h=a.indexOf("#");-1<h&&(b=a.substring(h+1),a=a.substring(0,h));h=a.indexOf("?");-1<h&&(d=a.substring(h+1),a=a.substring(0,h));g=a;a=new c.HTTP.QueryString(d);q(j,a);j.queryString=a.toString;j.toString=function(){var a=j.queryString();return g+(a.length>0?"?"+a:"")};j.asString=j.toString;j.fragment=function(){return b}};c.ServerURL=function(a){function j(a,b){b&&b.findEach(a,function(a,b){d.appendParam(a,
b)})}function g(a,b){return function(c){bt_log("invalid "+a+" expression: "+b+", exception = "+c)}}var d=this,b=a.window,h=a.parentReferrer,i=a.referrer;c.HTTP.URL.call(this,0===a.host.length?"":(a.host.match("^[a-z0-9+.-]+://.+")?"":"//")+a.host+"/tag");d.appendParams({site:a.site,referrer:i,docReferrer:a.docReferrer,mode:a.mode});i!==h&&d.appendParam("parentReferrer",h);j(/^btps\..+/,new c.HTTP.Cookie(a.document));j(/^btpdb\..+/,a.store);d.appendData=function(a){var c=bt_data(a),c=m.isArray(c)||
m.isObject(c)?b.JSON.stringify(c):c;return d.alwaysAppendParam("_cb_"+("bt_data('"+a+"')"),c)};d.appendJs=function(a){var b=g("client binding expression",a);return d.alwaysAppendParam("_cb_"+a,x(a,b))};d.cf=function(a){m.isArray(a)||(a=[a]);var b=d.param("cf");b&&(a=Array(b).concat(a));d.appendParam("cf",a.join());return d};d.addCf=function(a,b){if(!x(b,g("conditional fire",b,"tags/"+a+"-cf.js")))return!1;var c=d.param("cf");d.appendParam("cf",c?c+","+a:a);return!0}};c.Page=function(a,j){function g(a){l(m.isArray(a)?
a:[a],function(a){m.isFunction(a)?a():p.write('<script type="text/javascript" src="'+a+'"><\/script>')})}function d(a){var b=s.group().options({tagId:-2});l(m.isArray(a)?a:[a],function(a){(m.isFunction(a)?b.wait:b.script)(a)})}function b(a){p.write(a)}function h(a,b){var c={};b&&b.tagId&&(c.tagId=b.tagId);s.group(!u?"domready":void 0).options(c).wait(function(){p.write(a)})}function i(a){l(a,function(a){if(a.name){var b=q({},a);delete b.name;delete b.value;o.set(a.name,a.value,b)}})}function e(b){n.hasErrors()&&
(b.appendParam("errors",n.toJSON()),2083<b.toString().length&&(b.deleteParam("errors"),n.tooManyErrors(),b.appendParam("errors",n.toJSON())));n.reset({site:a.site,referrer:a.referrer||p.location.href})}var f=this,k=void 0,r=a.data||{},t=void 0,p=a.document||{},w=a.window||{},s=a.blab||c.Blab,n=a.errorManager,o=a.store,u=!1;f.referrer=a.referrer;f.parentReferrer=a.parentReferrer;f.docReferrer=a.docReferrer;f.site=a.site;f.host=a.host;n&&s.addGlobalListener(n);var v="sync"===a.mode;f.writeScript=v?
g:d;f.appendContent=v?b:h;f.domReady=function(){u=!0;s.addGlobalListener(new s.GlobalSwapwriteListener(p));"sync"===a.mode&&(f.writeScript=d,f.appendContent=h);s.run("domready")};f.parameter=function(a){void 0==k&&(k=new c.HTTP.URL(p.location.href));return k.param(a)};f.meta=function(a){t||(t={},l(p.getElementsByTagName("meta"),function(a){t[a.getAttribute("name")]=a.getAttribute("content")}));return t[a]||""};f.cookie=function(a){return(new c.HTTP.Cookie(p)).get(a)||""};f.data=function(a,b){if(void 0!==
b)return r[a]=b;b=r[a];return void 0==b?"":b};f.dbe=function(a,b,c){f.data(a,x(b,function(b){n&&n.push({type:"dbe",message:b.toString(),"dbe.name":a,pageId:(c||{}).pageId||-1})},"page-dbes/"+a+"-page-"+(c&&c.pageId||"adhoc")))};f.errors=function(a){n.configure(a)};f.store=o?i:function(){};f.serverURL=function(){return new c.ServerURL(a)};f.defaultBaseUri=function(){return("https:"==p.location.protocol?"https:":"http:")+"//s.btstatic.com/"};f.baseUri=function(){var a=/\btag(\.[^.]+|-n)?\.js(#.*)?$/;
return j&&j.src&&j.src.replace(a,"")||f.defaultBaseUri()};f.primary=function(){var a=[];w.JSON||a.push(f.baseUri()+"json2.js");a.push(function(){var a=f.serverURL();n&&(n.processStoredErrors(),e(a));return a.toString()}());f.writeScript(a)};f.secondary=function(a){var b=f.serverURL(),c=b.toString();a(b);b.toString()!=c&&(n&&e(b),f.writeScript(b.toString()))}};c.ErrorManager=function(a,c){function g(c){f.push(d(c));a.set(k,b.toJSON(),{path:"/"})}function d(a){var b=m.isObject(a)?q({},a):{};b.type=
b.type||"unknown";b.message=b.message||a.toString();b.timestamp=r;return b}if(!a)throw"ErrorManager requires a store";var b={},h,i,e=!0,f=[],k="__bterr",r=+new Date,l=b.configure=function(a){a.hasOwnProperty("enabled")&&(e=a.enabled);a.hasOwnProperty("timestamp")&&(r=a.timestamp);a.hasOwnProperty("site")&&(h=a.site);a.hasOwnProperty("referrer")&&(i=a.referrer)};c&&l(c);b.reset=function(b){b&&l(b);f=[];a.remove(k);a.remove(k,{path:"/"})};b.hasErrors=function(){return 0<f.length};b.toArray=function(){return f};
b.toJSON=function(){try{return JSON.stringify({site:h,referrer:i,errors:f})}catch(a){bt_log("problem serializing errors: "+a.message)}};b.push=function(a){bt_log("error: "+JSON.stringify(a));if(e&&a&&!(-1>a.tagId||-1>a.pageId))try{g(a)}catch(c){if("CookieTooLongError"!=c.name)throw c;b.tooManyErrors()}};b.tooManyErrors=function(){b.reset();g({type:"runtime",message:"Too many errors"})};b["block:error"]=function(a,c){if(c){var d=c.type,e=c.exception||c,f=a.option("tagId")||-1;b.push({type:d,message:e.toString(),
tagId:f})}};b.processStoredErrors=function(){var b=a.get(k);if(b)try{var c=JSON.parse(b);h=c.site;i=c.referrer;m.isArray(c.errors)&&(f=f.concat(c.errors))}catch(d){bt_log("problem reading stored errors: "+d.message)}};return b};c.CookieSyncEngine=function(a){var j={fn:function(a){a()},next:null},g=j,d=a.document,b=function(a){if("function"!=typeof a)return!1;a={fn:a,next:null};g=g.next=a;return!0},h=function(){if(j){var a=j.fn;j=j.next;a(h)}},i=h;c.Events.listen(a,"load",i);return{sync:i,push:function(a){return b(a)},
pushImage:function(c){return b(function(b){var d=new a.Image;d.onerror=d.onload=b;d.src=c})},pushIframe:function(a){return b(function(b){var c=d.createElement("iframe");c.onerror=c.onload=b;c.width=0;c.height=0;c.style.border=0;c.src=a;d.body.appendChild(c)})}}};c.jQueryLoader=function(a,j){return new function(a,d){function b(a){j.wait(a)}function h(a){function d(){e=c.jQuery;b(a)}f="var $ = BrightTag.$; ";c.jQuery?d():j.script(c.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(d)}var i={},e=
a.jQuery,f="",j=c.Blab.group(d);i.getJQuery=function(){return e};i.functionWithAccess=function(a,b){return new Function(a,f+b)};i.ensureJQuery=function(a){i.ensureJQuery=b;(e?b:h)(a);c.Blab.run(d)};return i}(a,j)};c.Main=function(a){var j=c.Events,g;a:{g=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/;for(var d=a.document.getElementsByTagName("script"),b=d.length-1;-1<b;b--){var h=d[b];if(g.test(h.src)){g=h;break a}}g=void 0}g&&((d=(new c.HTTP.URL(g.src)).fragment())&&q(a,(new c.HTTP.QueryString(d)).params()),d=
function(a){bt_log("configuration error: "+a)},b=c.trim(g.innerHTML),0!==b.length&&q(a,x("(\n"+b+"\n)",d,"site-config")));if(void 0!=a.site){j.enablePageReadyOverrides(a.window,a.document);try{var i=new c.Page(a,g);j.domReady(a.document,function(){i.domReady()});a.loadOnly||i.primary();return i}catch(e){bt_log("execution error: "+e)}}};var y=c.defaultConfig();q(c.Blab,new c.Blab.Manager(y.document));c.$LAB=c.Blab;c.EventBinding=c.EventBindingManager(y.window,y.errorManager);c.CookieSync=c.CookieSyncEngine(y.window);
c.instance=c.Main(y);return c}(window.BrightTag);function bt_parameter(c){return BrightTag.instance.parameter(c)}function bt_meta(c){return BrightTag.instance.meta(c)}function bt_cookie(c){return BrightTag.instance.cookie(c)}function bt_data(c,o){return BrightTag.instance.data(c,o)}window.bt_data_escaped=bt_data;function bt_log(c){window.console&&console.log&&console.log("BrightTag: "+c)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;
function btServe(c){if(void 0==BrightTag.instance){var o=BrightTag,v=o.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},o.defaultConfig());void 0!=_bt_url_prefix&&(v.host=_bt_url_prefix);o.instance=o.Main(o.extend(v,c||{}))}};
